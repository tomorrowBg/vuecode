{"version":3,"file":"vue.js","sources":["../src/observer/arr.js","../src/observer/index.js","../src/initState.js","../src/init.js","../src/index.js"],"sourcesContent":["// 劫持数组得方法\r\n// 重写数组得方法\r\n// 步骤1:获取原来得数组方法Array.prototype 得原型\r\nlet oldArrayProtoMehtods = Array.prototype\r\nconsole.log('oldArrayProtoMehtods数组原型', oldArrayProtoMehtods);\r\n\r\n// (2)继承\r\nexport let ArrayMethods = Object.create(oldArrayProtoMehtods)\r\nconsole.log('ArrayMethods继承数组', ArrayMethods);\r\n// 劫持\r\nlet methods = [\r\n    'push',\r\n    'pop',\r\n    'unshift',\r\n    'shift',\r\n    'splice'\r\n]\r\nmethods.forEach(item => {\r\n    ArrayMethods[item] = function(...args) {\r\n        console.log('劫持数组', args, this);\r\n        let res = oldArrayProtoMehtods[item].apply(this, args)\r\n        console.log('res', res);\r\n        // 问题:数组添加对象得情况, push, unshift , splice\r\n        let inserted;\r\n        switch(item) {\r\n            case 'push':\r\n            case 'unshift':\r\n                console.log('走动这里');\r\n                inserted = args\r\n                break;\r\n            case 'splice':\r\n                inserted = args.splice(2)\r\n                return\r\n        }\r\n        console.log('inserted', inserted);\r\n        let ob = this.__ob__ // 用来获取observerArray方法得\r\n        if (inserted) {\r\n            ob.observerArray(inserted) // 对象我们组件添加得对象经行劫持\r\n        }\r\n        return res\r\n    }\r\n})","import { ArrayMethods } from './arr'\r\nexport function observer(data) {\r\n    console.log('observer', data);\r\n    // data 得数据类型1对象\r\n    if (typeof data != 'object' || data == null) {\r\n        return data\r\n    }\r\n    // data 得数据类型1对象\r\n    return new Observer(data)\r\n}\r\nclass Observer {\r\n    constructor(value) {\r\n        console.log('value1', value);\r\n        // 判断数据是数组还是对象\r\n        // 判断是不是数组\r\n        // 给value定义个属性\r\n        Object.defineProperty(value, '__ob__', {\r\n            enumerable: false, // 不可枚举\r\n            value: this\r\n        })\r\n        if (Array.isArray(value)) {\r\n            // 是数组就走执行劫持数组得方法\r\n            console.log('数组执行这里', value);\r\n            value.__proto__ = ArrayMethods\r\n            // 如果是数组对象 [{q:1}]\r\n            this.observerArray(value)\r\n        } else {\r\n            // 不是的话就是走劫持对象得方法\r\n            // 遍历value 对象所有属性进行劫持\r\n            this.wakl(value)\r\n        }\r\n    }\r\n    wakl(data) {\r\n        let keys = Object.keys(data)\r\n        console.log('keys', keys);\r\n        for (let i = 0; i < keys.length; i++) {\r\n            // 对对象中得每个属性进行劫持\r\n            let key = keys[i]\r\n            let value = data[key]\r\n            // 对对象中得属性进行劫持\r\n            console.log('data, key, value', data, key, value);\r\n            defineRective(data, key, value)\r\n        }\r\n    }\r\n    // 用来劫持数组对象得\r\n    observerArray (value) {\r\n        for (let i = 0; i< value.length; i++) {\r\n            observer(value[i])\r\n        }\r\n    }\r\n}\r\n// 对对象中得属性进行劫持\r\nfunction defineRective(data, key, value) { // {a:{b: 1}}\r\n    console.log('11111');\r\n    observer(value) // 深层递归, 判断是不是对象套对象\r\n    Object.defineProperty(data, key, {\r\n        get() {\r\n            console.log('获取值');\r\n            return value\r\n        },\r\n        set(newVaule) {\r\n            if (newVaule === value) return\r\n            observer(value) // 设置得值再次进行劫持\r\n            value = newVaule // 如果用户设置得值是对象就要进行递归\r\n        }\r\n    })\r\n}\r\n// vue2数据劫持使用:object.definePropert 缺点:只能对对象中得属性进行劫持,而不是整个对象\r\n// data 得俩种情况 1, 是对象 {a: {}}, list: []\r\n// 总结:(1)对象\r\n// Object.defineProperty 缺点: 只能对象得属性一个一个得进行劫持\r\n// 遍历劫持\r\n// 递归: get set\r\n// 数组得劫持,采用函数劫持\r\n// list: [1,3,3,4,5] arr: [{qq:1}, {11: 2}]\r\n// 函数劫持:重写数组得方法(push,pop....)","import { observer } from \"./observer/index\";\r\n\r\nexport function initState(vm) {\r\n    let opts = vm.$options\r\n    console.log('opts', opts);\r\n    // 下面就是判断带过来什么值\r\n    // 判断传过来什么,就初始化什么值\r\n    // 初始化props\r\n    if (opts.props) {\r\n        initProps()\r\n    }\r\n    // 初始化data\r\n    if (opts.data) {\r\n        initData(vm)\r\n    }\r\n    // 初始化watch\r\n    if (opts.watch) {\r\n        initWatch()\r\n    }\r\n    // 初始化compouted\r\n    if (opts.compouted) {\r\n        initCompouted()\r\n    }\r\n    // 初始化methods\r\n    if (opts.methods) {\r\n        initMethods()\r\n    }\r\n}\r\nfunction initCompouted() {}\r\nfunction initMethods () {}\r\nfunction initProps () {}\r\nfunction initWatch (){}\r\n\r\n// vue2对data经行初始化 , data有俩种情况,1,是对象,2是函数\r\n// 第一种情况 \r\nfunction initData (vm) {\r\n    console.log('data初始化', vm);\r\n    let data = vm.$options.data\r\n    data = vm._data = typeof data === 'function' ? data.call(vm) : data // 注意一个问题this得指向\r\n    console.log('data', data);\r\n    // 将data上得所有得属性代理到实例上\r\n    for (let key in data) {\r\n        proxy(vm, '_data', key)\r\n    }\r\n    // data数据进行劫持\r\n    observer(data)\r\n}\r\nfunction proxy(vm, source, key) {\r\n    Object.defineProperty(vm, key, {\r\n        get() {\r\n            return vm[source][key]\r\n        },\r\n        set (val) {\r\n            return vm[source][key] = val\r\n        }\r\n    })\r\n}","/*\r\n * @Author: white tomorrowBg@163.com\r\n * @Date: 2023-05-06 17:11:45\r\n * @LastEditors: yyds白 11935851+yyds-white@user.noreply.gitee.com\r\n * @LastEditTime: 2023-05-11 17:20:27\r\n * @FilePath: \\vue_code\\src\\init.js\r\n * @Description: 初始化文件方法\r\n * Copyright (c) 2023 by ${git_name_email}, All Rights Reserved.\r\n */\r\nimport { initState } from \"./initState\"\r\n// import { compileToFunction } from \"./compile\"\r\nexport function initMixin(Vue) {\r\n    Vue.prototype._init = function (options) {\r\n        console.log(options, 2)\r\n        let vm = this // this就是vue得实例\r\n        vm.$options = options\r\n        // 初始化状态\r\n        initState(vm)\r\n        // 模板编译\r\n        if (vm.$options.el) {\r\n            vm.$mount(vm.$options.el)\r\n        }\r\n    }\r\n    Vue.prototype.$mount = function (el) {\r\n        console.log('88888888888888');\r\n        let vm = this\r\n        el = document.querySelector(el) // 获取元素\r\n        let options = vm.$options\r\n        if (!options.render) {\r\n            let template = options.template\r\n            if (!template && el) {\r\n                // 获取html\r\n                el = el.outerHTML\r\n                console.log(`%c vue-devtools %c Detected Vue v${Vue.version} %c`,'background:#35495e ; padding: 1px; border-radius: 3px 0 0 3px;  color: #fff','background:#41b883 ; padding: 1px; border-radius: 0 3px 3px 0;  color: #fff','background:transparent', el, 8989); // => <div id=\"app\">{{msg}}</div>\r\n                // 变成ast语法树\r\n                let ast =  compileToFunction(el)\r\n                // 变成render函数\r\n            }\r\n        }\r\n    }\r\n}\r\n// ast语法树 可以操作css, js 和元素节点\r\n// vnode 虚拟dom, vnode只能操作元素节点\r\n// ast语法树  <div id=\"app\">heelo<div></div></div>\r\n/**\r\n * {\r\n * tag: 'div',标签名称\r\n * attrs: [{id: \"#app\"}], 属性\r\n * children:[{tag: null, text: hello},{tag: 'div'}], 子元素\r\n * }\r\n */","// 引入初始化的方法\r\nimport { initMixin } from \"./init\"\r\nfunction Vue (options) {\r\n    // 这里的options就是初始化的data,methods....vue上的方法\r\n    // init 初始化的方法 (模块化)\r\n    console.log('1');\r\n    this._init(options)\r\n}\r\nconsole.log('3');\r\ninitMixin(Vue)\r\nexport default Vue"],"names":[],"mappings":";;;;;;IAAA;IACA;IACA;IACA,IAAI,oBAAoB,GAAG,KAAK,CAAC,UAAS;IAC1C,OAAO,CAAC,GAAG,CAAC,0BAA0B,EAAE,oBAAoB,CAAC,CAAC;AAC9D;IACA;IACO,IAAI,YAAY,GAAG,MAAM,CAAC,MAAM,CAAC,oBAAoB,EAAC;IAC7D,OAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE,YAAY,CAAC,CAAC;IAC9C;IACA,IAAI,OAAO,GAAG;IACd,IAAI,MAAM;IACV,IAAI,KAAK;IACT,IAAI,SAAS;IACb,IAAI,OAAO;IACX,IAAI,QAAQ;IACZ,EAAC;IACD,OAAO,CAAC,OAAO,CAAC,IAAI,IAAI;IACxB,IAAI,YAAY,CAAC,IAAI,CAAC,GAAG,SAAS,GAAG,IAAI,EAAE;IAC3C,QAAQ,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;IACxC,QAAQ,IAAI,GAAG,GAAG,oBAAoB,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,EAAC;IAC9D,QAAQ,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;IAChC;IACA,QAAQ,IAAI,QAAQ,CAAC;IACrB,QAAQ,OAAO,IAAI;IACnB,YAAY,KAAK,MAAM,CAAC;IACxB,YAAY,KAAK,SAAS;IAC1B,gBAAgB,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;IACpC,gBAAgB,QAAQ,GAAG,KAAI;IAC/B,gBAAgB,MAAM;IACtB,YAAY,KAAK,QAAQ;IACzB,gBAAgB,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,EAAC;IACzC,gBAAgB,MAAM;IACtB,SAAS;IACT,QAAQ,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;IAC1C,QAAQ,IAAI,EAAE,GAAG,IAAI,CAAC,OAAM;IAC5B,QAAQ,IAAI,QAAQ,EAAE;IACtB,YAAY,EAAE,CAAC,aAAa,CAAC,QAAQ,EAAC;IACtC,SAAS;IACT,QAAQ,OAAO,GAAG;IAClB,MAAK;IACL,CAAC;;ICxCM,SAAS,QAAQ,CAAC,IAAI,EAAE;IAC/B,IAAI,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;IAClC;IACA,IAAI,IAAI,OAAO,IAAI,IAAI,QAAQ,IAAI,IAAI,IAAI,IAAI,EAAE;IACjD,QAAQ,OAAO,IAAI;IACnB,KAAK;IACL;IACA,IAAI,OAAO,IAAI,QAAQ,CAAC,IAAI,CAAC;IAC7B,CAAC;IACD,MAAM,QAAQ,CAAC;IACf,IAAI,WAAW,CAAC,KAAK,EAAE;IACvB,QAAQ,OAAO,CAAC,GAAG,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;IACrC;IACA;IACA;IACA,QAAQ,MAAM,CAAC,cAAc,CAAC,KAAK,EAAE,QAAQ,EAAE;IAC/C,YAAY,UAAU,EAAE,KAAK;IAC7B,YAAY,KAAK,EAAE,IAAI;IACvB,SAAS,EAAC;IACV,QAAQ,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;IAClC;IACA,YAAY,OAAO,CAAC,GAAG,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;IACzC,YAAY,KAAK,CAAC,SAAS,GAAG,aAAY;IAC1C;IACA,YAAY,IAAI,CAAC,aAAa,CAAC,KAAK,EAAC;IACrC,SAAS,MAAM;IACf;IACA;IACA,YAAY,IAAI,CAAC,IAAI,CAAC,KAAK,EAAC;IAC5B,SAAS;IACT,KAAK;IACL,IAAI,IAAI,CAAC,IAAI,EAAE;IACf,QAAQ,IAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,EAAC;IACpC,QAAQ,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;IAClC,QAAQ,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;IAC9C;IACA,YAAY,IAAI,GAAG,GAAG,IAAI,CAAC,CAAC,EAAC;IAC7B,YAAY,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,EAAC;IACjC;IACA,YAAY,OAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE,IAAI,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC;IAC9D,YAAY,aAAa,CAAC,IAAI,EAAE,GAAG,EAAE,KAAK,EAAC;IAC3C,SAAS;IACT,KAAK;IACL;IACA,IAAI,aAAa,CAAC,CAAC,KAAK,EAAE;IAC1B,QAAQ,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;IAC9C,YAAY,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,EAAC;IAC9B,SAAS;IACT,KAAK;IACL,CAAC;IACD;IACA,SAAS,aAAa,CAAC,IAAI,EAAE,GAAG,EAAE,KAAK,EAAE;IACzC,IAAI,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;IACzB,IAAI,QAAQ,CAAC,KAAK,EAAC;IACnB,IAAI,MAAM,CAAC,cAAc,CAAC,IAAI,EAAE,GAAG,EAAE;IACrC,QAAQ,GAAG,GAAG;IACd,YAAY,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;IAC/B,YAAY,OAAO,KAAK;IACxB,SAAS;IACT,QAAQ,GAAG,CAAC,QAAQ,EAAE;IACtB,YAAY,IAAI,QAAQ,KAAK,KAAK,EAAE,MAAM;IAC1C,YAAY,QAAQ,CAAC,KAAK,EAAC;IAC3B,YAAY,KAAK,GAAG,SAAQ;IAC5B,SAAS;IACT,KAAK,EAAC;IACN,CAAC;IACD;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;ICzEO,SAAS,SAAS,CAAC,EAAE,EAAE;IAC9B,IAAI,IAAI,IAAI,GAAG,EAAE,CAAC,SAAQ;IAC1B,IAAI,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;IAC9B;IACA;IACA;IACA,IAAI,IAAI,IAAI,CAAC,KAAK,EAAE,CAEf;IACL;IACA,IAAI,IAAI,IAAI,CAAC,IAAI,EAAE;IACnB,QAAQ,QAAQ,CAAC,EAAE,EAAC;IACpB,KAAK;IACL;IACA,IAAI,IAAI,IAAI,CAAC,KAAK,EAAE,CAEf;IACL;IACA,IAAI,IAAI,IAAI,CAAC,SAAS,EAAE,CAEnB;IACL;IACA,IAAI,IAAI,IAAI,CAAC,OAAO,EAAE,CAEjB;IACL,CAAC;AAKD;IACA;IACA;IACA,SAAS,QAAQ,EAAE,EAAE,EAAE;IACvB,IAAI,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;IAC/B,IAAI,IAAI,IAAI,GAAG,EAAE,CAAC,QAAQ,CAAC,KAAI;IAC/B,IAAI,IAAI,GAAG,EAAE,CAAC,KAAK,GAAG,OAAO,IAAI,KAAK,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,KAAI;IACvE,IAAI,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;IAC9B;IACA,IAAI,KAAK,IAAI,GAAG,IAAI,IAAI,EAAE;IAC1B,QAAQ,KAAK,CAAC,EAAE,EAAE,OAAO,EAAE,GAAG,EAAC;IAC/B,KAAK;IACL;IACA,IAAI,QAAQ,CAAC,IAAI,EAAC;IAClB,CAAC;IACD,SAAS,KAAK,CAAC,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE;IAChC,IAAI,MAAM,CAAC,cAAc,CAAC,EAAE,EAAE,GAAG,EAAE;IACnC,QAAQ,GAAG,GAAG;IACd,YAAY,OAAO,EAAE,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC;IAClC,SAAS;IACT,QAAQ,GAAG,CAAC,CAAC,GAAG,EAAE;IAClB,YAAY,OAAO,EAAE,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,GAAG,GAAG;IACxC,SAAS;IACT,KAAK,EAAC;IACN;;ICxDA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IAEA;IACO,SAAS,SAAS,CAAC,GAAG,EAAE;IAC/B,IAAI,GAAG,CAAC,SAAS,CAAC,KAAK,GAAG,UAAU,OAAO,EAAE;IAC7C,QAAQ,OAAO,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC,EAAC;IAC/B,QAAQ,IAAI,EAAE,GAAG,KAAI;IACrB,QAAQ,EAAE,CAAC,QAAQ,GAAG,QAAO;IAC7B;IACA,QAAQ,SAAS,CAAC,EAAE,EAAC;IACrB;IACA,QAAQ,IAAI,EAAE,CAAC,QAAQ,CAAC,EAAE,EAAE;IAC5B,YAAY,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,QAAQ,CAAC,EAAE,EAAC;IACrC,SAAS;IACT,MAAK;IACL,IAAI,GAAG,CAAC,SAAS,CAAC,MAAM,GAAG,UAAU,EAAE,EAAE;IACzC,QAAQ,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;IACtC,QAAQ,IAAI,EAAE,GAAG,KAAI;IACrB,QAAQ,EAAE,GAAG,QAAQ,CAAC,aAAa,CAAC,EAAE,EAAC;IACvC,QAAQ,IAAI,OAAO,GAAG,EAAE,CAAC,SAAQ;IACjC,QAAQ,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;IAC7B,YAAY,IAAI,QAAQ,GAAG,OAAO,CAAC,SAAQ;IAC3C,YAAY,IAAI,CAAC,QAAQ,IAAI,EAAE,EAAE;IACjC;IACA,gBAAgB,EAAE,GAAG,EAAE,CAAC,UAAS;IACjC,gBAAgB,OAAO,CAAC,GAAG,CAAC,CAAC,iCAAiC,EAAE,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,6EAA6E,CAAC,6EAA6E,CAAC,wBAAwB,EAAE,EAAE,EAAE,IAAI,CAAC,CAAC;IACjR;IACA,gBAA2B,iBAAiB,CAAC,EAAE,EAAC;IAChD;IACA,aAAa;IACb,SAAS;IACT,MAAK;IACL,CAAC;IACD;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IClDA;IAEA,SAAS,GAAG,EAAE,OAAO,EAAE;IACvB;IACA;IACA,IAAI,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IACrB,IAAI,IAAI,CAAC,KAAK,CAAC,OAAO,EAAC;IACvB,CAAC;IACD,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IACjB,SAAS,CAAC,GAAG;;;;;;;;"}